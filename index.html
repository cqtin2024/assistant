<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Smart Setup Assistant V4</title>
<style>
  body { font-family: system-ui, sans-serif; background: #f3f4f6; color: #111; padding: 20px; }
  .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin: 20px auto; max-width: 700px; }
  .step { margin-top: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
  label { font-weight: 600; display: block; margin-top: 8px; }
  input, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; margin-top: 4px; }
  button { background: #1d4ed8; color: white; border: none; padding: 10px 20px; border-radius: 6px; margin-top: 15px; cursor: pointer; }
  button:hover { background: #2563eb; }
  .status { margin-top: 20px; background: #f1f5f9; padding: 12px; border-radius: 6px; font-size: 14px; white-space: pre-wrap; }
</style>
</head>
<body>
  <h1>ü§ñ Smart Setup Assistant V4</h1>
  <p>Thi·∫øt l·∫≠p t·ª± ƒë·ªông d·ª± √°n (GitHub + Firebase + Vercel)</p>

  <div class="card">
    <div class="step">
      <h2>1Ô∏è‚É£ GitHub</h2>
      <label>Personal Access Token</label>
      <input type="password" id="ghToken" placeholder="ghp_..." />
      <label>T√™n repository</label>
      <input type="text" id="ghRepo" placeholder="username/repo" />
      <button id="btnTestGitHub">Ki·ªÉm tra GitHub</button>
    </div>

    <div class="step">
      <h2>2Ô∏è‚É£ Firebase</h2>
      <label>Realtime Database URL</label>
      <input type="url" id="fbUrl" placeholder="https://xxx-default-rtdb.firebaseio.com/" />
      <label>Firebase Config (JSON)</label>
      <textarea id="fbConfig" rows="4" placeholder='{"apiKey":"...","authDomain":"..."}'></textarea>
      <button id="btnTestFirebase">Ki·ªÉm tra Firebase</button>
    </div>

    <div class="step">
      <h2>3Ô∏è‚É£ Vercel</h2>
      <label>Vercel Token</label>
      <input type="password" id="vcToken" placeholder="vercel_xxxxx" />
      <button id="btnDeploy">Deploy v√† c·∫•u h√¨nh</button>
    </div>

    <div class="status" id="logBox">üü¢ S·∫µn s√†ng b·∫Øt ƒë·∫ßu thi·∫øt l·∫≠p...</div>
  </div>

  <script>
    const logBox = document.getElementById('logBox');
    const log = (msg, color = '#000') => {
      logBox.innerHTML += `\n<span style="color:${color}">${msg}</span>`;
      logBox.scrollTop = logBox.scrollHeight;
    };

    document.getElementById('btnTestGitHub').onclick = async () => {
      const token = document.getElementById('ghToken').value.trim();
      const repo = document.getElementById('ghRepo').value.trim();
      if (!token || !repo) return log('‚ùå Thi·∫øu GitHub token ho·∫∑c repo.', 'red');

      log('üîç ƒêang ki·ªÉm tra GitHub...');
      const res = await fetch('/api/setup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'test_github', token, repo })
      });
      log(await res.text(), res.ok ? 'green' : 'red');
    };

    document.getElementById('btnTestFirebase').onclick = async () => {
      const fbUrl = document.getElementById('fbUrl').value.trim();
      if (!fbUrl) return log('‚ùå Thi·∫øu URL Firebase.', 'red');

      log('üîç ƒêang ki·ªÉm tra Firebase...');
      try {
        const test = await fetch(fbUrl + '/assistant_test.json', {
          method: 'PUT',
          body: JSON.stringify({ ok: true })
        });
        if (test.ok) log('‚úÖ Firebase ho·∫°t ƒë·ªông!', 'green');
        else throw new Error('Firebase t·ª´ ch·ªëi ghi.');
      } catch (err) {
        log('‚ùå Firebase l·ªói: ' + err.message, 'red');
      }
    };

    document.getElementById('btnDeploy').onclick = async () => {
      const data = {
        action: 'deploy',
        ghToken: document.getElementById('ghToken').value,
        ghRepo: document.getElementById('ghRepo').value,
        fbUrl: document.getElementById('fbUrl').value,
        fbConfig: document.getElementById('fbConfig').value,
        vcToken: document.getElementById('vcToken').value
      };
      log('üöÄ ƒêang g·ª≠i y√™u c·∫ßu deploy...');
      const res = await fetch('/api/setup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const txt = await res.text();
      log(txt, res.ok ? 'green' : 'red');
    };
  </script>
</body>
</html>
